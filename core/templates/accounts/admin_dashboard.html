<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  {% load static %}
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <link rel="stylesheet" href="{% static 'css/admin_dashboard.css' %}">
</head>
<body>
  <!-- TOP NAVBAR -->
  <header class="top-navbar">
    <button class="hamburger-btn" onclick="document.querySelector('.sidebar').classList.toggle('active'); document.querySelector('.sidebar-overlay').classList.toggle('active');">
      <i class="fas fa-bars"></i>
    </button>
    <div class="navbar-brand">
      <i class="fas fa-shield-alt"></i>
      <span>AdminPanel</span>
    </div>
    <div class="navbar-right">
      <div class="search-wrapper">
        <form method="get" action="{% url 'admin_dashboard' %}" class="navbar-search">
          <i class="fas fa-search"></i>
          <input type="text" name="q" placeholder="Search users, customers..." value="{{ request.GET.q }}">
        </form>
      </div>
      <div class="navbar-user">
        <span class="user-name">{{ user.get_full_name|default:user.username }}</span>
        <form id="logout-form" method="post" action="{% url 'logout' %}">
          {% csrf_token %}
          <button type="submit" class="btn-logout">
            <i class="fas fa-sign-out-alt"></i>
          </button>
        </form>
      </div>
    </div>
  </header>

  <div class="main-wrapper">
    <!-- SIDEBAR -->
    <aside class="sidebar">
      <nav class="sidebar-nav">
        <div class="nav-section">
          <h3 class="nav-section-title">Management</h3>
          <a href="#manage-users" class="nav-item active" data-section="manage-users">
            <i class="fas fa-users"></i>
            <span>Manage User Roles</span>
          </a>
          <a href="#manage-customers" class="nav-item" data-section="manage-customers">
            <i class="fas fa-sitemap"></i>
            <span>Manage Customers</span>
          </a>
          <a href="#user-lists" class="nav-item" data-section="user-lists">
            <i class="fas fa-list"></i>
            <span>User Lists</span>
          </a>
        </div>

        <div class="nav-section">
          <h3 class="nav-section-title">Quick Actions</h3>
          <a href="{% url 'manage_file_categories' %}" class="nav-item" target="_blank">
            <i class="fas fa-file"></i>
            <span>File Categories</span>
          </a>
          <a href="{% url 'pre_dashboards' %}" class="nav-item" target="_blank">
            <i class="fas fa-chart-line"></i>
            <span>Pre-Dashboards</span>
          </a>
        </div>

        <div class="nav-section">
          <h3 class="nav-section-title">Statistics</h3>
          <div class="stat-item">
            <div class="stat-label">Total Users</div>
            <div class="stat-value">{{ total_users }}</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">Total Files</div>
            <div class="stat-value">{{ total_files }}</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">Open Tickets</div>
            <div class="stat-value">{{ open_tickets }}</div>
          </div>
        </div>
      </nav>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="main-content">
      <!-- WELCOME SECTION -->
      <section class="welcome-banner">
        <div>
          <h1>Welcome, <span class="highlight">{{ user.username }}</span></h1>
          <p>Manage users, customers, and system assignments</p>
        </div>
      </section>

      {% if messages %}
        <div class="messages-container">
          {% for message in messages %}
            <div class="alert alert-{{ message.tags|default:'info' }}">
              <i class="fas fa-{{ message.tags|default:'info-circle' }}"></i>
              <span>{{ message }}</span>
              <button type="button" class="close-alert">&times;</button>
            </div>
          {% endfor %}
        </div>
      {% endif %}

      {% if request.GET.q %}
        <div class="search-summary">
          <i class="fas fa-search"></i>
          <span>Search results for "<strong>{{ request.GET.q }}</strong>":</span>
          <span class="badge">{{ users|length }} users</span>
          <span class="badge">{{ customers|length }} customers</span>
          <span class="badge">{{ terminals|length }} terminals</span>
        </div>
      {% endif %}

      <!-- SECTION: MANAGE USER ROLES -->
      <section id="manage-users" class="content-section active">
        <div class="section-header">
          <h2><i class="fas fa-users-cog"></i> Manage User Roles</h2>
          <p>Create new users and manage their roles and permissions</p>
        </div>

        <!-- CREATE NEW USER FORM -->
        <div class="card create-user-card">
          <h3><i class="fas fa-user-plus"></i> Create New User</h3>
          <form method="post" action="{% url 'create_user' %}" class="form-grid">
            {% csrf_token %}
            <div class="form-row">
              <input type="text" name="first_name" placeholder="First Name" required>
              <input type="text" name="last_name" placeholder="Last Name" required>
            </div>
            <div class="form-row">
              <input type="text" name="username" placeholder="Username" required>
              <input type="email" name="email" placeholder="Email" required>
            </div>
            <div class="form-row">
              <input type="text" name="phone" placeholder="Phone" required>
              <input type="text" name="id_number" placeholder="ID Number" required>
            </div>
            <div class="form-row">
              <input type="password" name="password" placeholder="Password" required>
              <input type="password" name="confirm_password" placeholder="Confirm Password" required>
            </div>
            <div class="form-row">
              <select name="role" required>
                <option value="">Select Role</option>
                <option value="Director">Director</option>
                <option value="Manager">Manager</option>
                <option value="Staff">Staff</option>
              </select>
              <button type="submit" class="btn btn-primary">
                <i class="fas fa-user-plus"></i> Create User
              </button>
            </div>
          </form>
        </div>

        <!-- USERS TABLE -->
        <div class="card users-table-card">
          <h3>User Management</h3>
          <div class="table-wrapper">
            <table class="data-table">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Username</th>
                  <th>Email</th>
                  <th>Phone</th>
                  <th>Current Role</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                {% for user in users %}
                  <tr>
                    <td><small>{{ user.profile.id_number }}</small></td>
                    <td><strong>{{ user.username }}</strong></td>
                    <td>{{ user.email }}</td>
                    <td>{{ user.profile.phone_number }}</td>
                    <td>
                      {% if user.groups.first %}
                        <span class="badge-role">{{ user.groups.first.name }}</span>
                      {% else %}
                        <span class="badge-none">No Role</span>
                      {% endif %}
                    </td>
                    <td>
                      <div class="action-buttons">
                        <form method="post" action="{% url 'admin_dashboard' %}" class="inline-form">
                          {% csrf_token %}
                          <input type="hidden" name="user_id" value="{{ user.id }}">
                          <input type="hidden" name="action" value="update_role">
                          <select name="new_role" required class="role-select">
                            <option value="">--Select--</option>
                            <option value="Director" {% if user.groups.first.name == "Director" %}selected{% endif %}>Director</option>
                            <option value="Manager" {% if user.groups.first.name == "Manager" %}selected{% endif %}>Manager</option>
                            <option value="Staff" {% if user.groups.first.name == "Staff" %}selected{% endif %}>Staff</option>
                          </select>
                          <button type="submit" class="btn btn-sm btn-secondary">Update</button>
                        </form>

                        <button type="button" class="btn btn-sm btn-info btn-edit" 
                          data-id="{{ user.id }}" 
                          data-username="{{ user.username }}"
                          data-first_name="{{ user.first_name }}" 
                          data-last_name="{{ user.last_name }}"
                          data-email="{{ user.email }}" 
                          data-phone="{{ user.profile.phone_number }}"
                          data-id_number="{{ user.profile.id_number }}">
                          <i class="fas fa-edit"></i> Edit
                        </button>

                        <button type="button" class="btn btn-sm btn-warning btn-remove-role" 
                          data-user-id="{{ user.id }}" 
                          data-username="{{ user.username }}">
                          <i class="fas fa-trash"></i> Remove Role
                        </button>

                        <button type="button" class="btn btn-sm btn-danger btn-delete-user" 
                          data-user-id="{{ user.id }}" 
                          data-username="{{ user.username }}">
                          <i class="fas fa-trash-alt"></i> Delete
                        </button>
                      </div>
                    </td>
                  </tr>
                {% empty %}
                  <tr>
                    <td colspan="6" class="text-center text-muted">No users found</td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- SECTION: MANAGE CUSTOMERS -->
      <section id="manage-customers" class="content-section">
        <div class="section-header">
          <h2><i class="fas fa-building"></i> Manage Customers & Assignments</h2>
          <p>Assign overseers and custodians to customers and terminals</p>
        </div>

        {% for customer in customers %}
          <div class="card customer-card">
            <div class="customer-header">
              <h3>{{ customer.name }}</h3>
              <span class="badge-customer">Customer</span>
            </div>

            <!-- Overseer Assignment -->
            <div class="assignment-section">
              <h4><i class="fas fa-user-tie"></i> Overseer Assignment</h4>
              <form method="post" action="{% url 'admin_dashboard' %}" class="assignment-form">
                {% csrf_token %}
                <input type="hidden" name="customer_id" value="{{ customer.id }}">
                <input type="hidden" name="action" value="assign_overseer_or_custodian">
                
                <div class="form-group-inline">
                  <select name="overseer_id" required>
                    <option value="">-- Select Overseer --</option>
                    {% for user in users %}
                      <option value="{{ user.id }}" {% if customer.overseer and customer.overseer.id == user.id %}selected{% endif %}>
                        {{ user.get_full_name }} ({{ user.username }})
                      </option>
                    {% endfor %}
                  </select>
                  <button type="submit" class="btn btn-primary btn-sm">
                    <i class="fas fa-save"></i> Update Overseer
                  </button>
                </div>
              </form>

              {% if customer.overseer %}
                <div class="assignment-info">
                  <span class="badge-assigned">
                    <i class="fas fa-check"></i> Assigned: {{ customer.overseer.get_full_name }}
                  </span>
                  <button type="button" class="btn btn-sm btn-warning btn-remove-overseer" 
                    data-customer-id="{{ customer.id }}" 
                    data-customer-name="{{ customer.name }}">
                    <i class="fas fa-unlink"></i> Remove
                  </button>
                </div>
              {% endif %}
            </div>

            <!-- Custodian Assignments (Terminals) -->
            {% if customer.terminals %}
              <div class="assignment-section">
                <h4><i class="fas fa-key"></i> Custodian Assignments by Terminal</h4>
                <div class="table-wrapper">
                  <table class="data-table compact">
                    <thead>
                      <tr>
                        <th>Branch / Terminal</th>
                        <th>Custodian</th>
                        <th>Actions</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for terminal in customer.terminals %}
                        <tr>
                          <td><strong>{{ terminal.branch_name }}</strong></td>
                          <td>
                            {% if terminal.custodian %}
                              <span class="badge-assigned">
                                <i class="fas fa-check"></i> {{ terminal.custodian.get_full_name }}
                              </span>
                            {% else %}
                              <span class="badge-none">Not assigned</span>
                            {% endif %}
                          </td>
                          <td>
                            <form method="post" action="{% url 'admin_dashboard' %}" class="assignment-form inline">
                              {% csrf_token %}
                              <input type="hidden" name="action" value="assign_custodian">
                              <input type="hidden" name="customer_id" value="{{ customer.id }}">
                              <input type="hidden" name="terminal_id" value="{{ terminal.id }}">
                              
                              <select name="custodian_id" required>
                                <option value="">-- Select Custodian --</option>
                                {% for user in users %}
                                  <option value="{{ user.id }}" {% if terminal.custodian and terminal.custodian.id == user.id %}selected{% endif %}>
                                    {{ user.get_full_name }} ({{ user.username }})
                                  </option>
                                {% endfor %}
                              </select>
                              <button type="submit" class="btn btn-primary btn-sm">Update</button>
                            </form>

                            {% if terminal.custodian %}
                              <button type="button" class="btn btn-sm btn-warning btn-remove-custodian" 
                                data-customer-id="{{ customer.id }}" 
                                data-terminal-id="{{ terminal.id }}"
                                data-terminal-name="{{ terminal.branch_name }}">
                                <i class="fas fa-unlink"></i> Remove
                              </button>
                            {% endif %}
                          </td>
                        </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </div>
              </div>
            {% else %}
              <p class="text-muted"><i class="fas fa-info-circle"></i> No terminals defined for this customer.</p>
            {% endif %}
          </div>
        {% empty %}
          <div class="empty-state">
            <i class="fas fa-inbox"></i>
            <p>No customers available</p>
          </div>
        {% endfor %}
      </section>

      <!-- SECTION: USER LISTS -->
      <section id="user-lists" class="content-section">
        <div class="section-header">
          <h2><i class="fas fa-clipboard-list"></i> User Role Summary</h2>
          <p>Quick overview of all users by role</p>
        </div>

        <div class="grid-2col">
          <div class="card">
            <h3><i class="fas fa-user-shield"></i> Overseers</h3>
            {% if overseers %}
              <ul class="user-list">
                {% for user in overseers %}
                  <li>
                    <i class="fas fa-circle-check" style="color: #27ae60;"></i>
                    {{ user.get_full_name }} 
                    <small>({{ user.username }})</small>
                  </li>
                {% endfor %}
              </ul>
            {% else %}
              <p class="text-muted"><em>No overseers defined</em></p>
            {% endif %}
          </div>

          <div class="card">
            <h3><i class="fas fa-key"></i> Custodians</h3>
            {% if custodians %}
              <ul class="user-list">
                {% for user in custodians %}
                  <li>
                    <i class="fas fa-circle-check" style="color: #3498db;"></i>
                    {{ user.get_full_name }} 
                    <small>({{ user.username }})</small>
                  </li>
                {% endfor %}
              </ul>
            {% else %}
              <p class="text-muted"><em>No custodians defined</em></p>
            {% endif %}
          </div>
        </div>

        <div class="card">
          <h3><i class="fas fa-exclamation-circle" style="color: #f39c12;"></i> Users Without Customer Roles</h3>
          {% if users_without_roles %}
            <ul class="user-list">
              {% for user in users_without_roles %}
                <li>
                  {{ user.get_full_name }} 
                  <small>({{ user.username }})</small>
                </li>
              {% endfor %}
            </ul>
          {% else %}
            <p class="text-muted"><em>All users have roles assigned</em></p>
          {% endif %}
        </div>
      </section>
    </main>
  </div>

  <!-- ==================== MODALS ==================== -->

  <!-- Edit User Modal -->
  <div class="modal fade" id="editUserModal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Edit User Details</h5>
          <button type="button" class="btn-close" data-dismiss="modal">&times;</button>
        </div>
        <form method="POST" action="{% url 'update_user' %}" id="editUserForm">
          {% csrf_token %}
          <div class="modal-body">
            <input type="hidden" name="user_id" id="user_id">
            
            <div class="form-group">
              <label for="first_name">First Name</label>
              <input type="text" class="form-control" id="first_name" name="first_name" required>
            </div>
            <div class="form-group">
              <label for="last_name">Last Name</label>
              <input type="text" class="form-control" id="last_name" name="last_name" required>
            </div>
            <div class="form-group">
              <label for="email">Email</label>
              <input type="email" class="form-control" id="email" name="email" required>
            </div>
            <div class="form-group">
              <label for="phone">Phone Number</label>
              <input type="text" class="form-control" id="phone" name="phone" required>
            </div>
            <div class="form-group">
              <label for="id_number">ID Number</label>
              <input type="text" class="form-control" id="id_number" name="id_number" required>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-primary">Save Changes</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Confirm Remove Role Modal -->
  <div class="modal fade" id="confirmRemoveRoleModal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-sm" role="document">
      <div class="modal-content">
        <div class="modal-header alert-warning">
          <h5 class="modal-title"><i class="fas fa-exclamation-triangle"></i> Confirm Action</h5>
          <button type="button" class="btn-close" data-dismiss="modal">&times;</button>
        </div>
        <div class="modal-body">
          <p>Are you sure you want to remove the role assignment from <strong id="removeRoleUsername"></strong>?</p>
          <p class="text-muted"><small>This user will no longer have any role assigned.</small></p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-warning" id="confirmRemoveRoleBtn">Remove Role</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Confirm Delete User Modal -->
  <div class="modal fade" id="confirmDeleteUserModal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-sm" role="document">
      <div class="modal-content">
        <div class="modal-header alert-danger">
          <h5 class="modal-title"><i class="fas fa-trash-alt"></i> Delete User</h5>
          <button type="button" class="btn-close" data-dismiss="modal">&times;</button>
        </div>
        <div class="modal-body">
          <p>Are you sure you want to permanently delete user <strong id="deleteUsername"></strong>?</p>
          <p class="text-danger"><small><i class="fas fa-exclamation-circle"></i> This action cannot be undone.</small></p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-danger" id="confirmDeleteUserBtn">Delete User</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Confirm Remove Overseer Modal -->
  <div class="modal fade" id="confirmRemoveOverseerModal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-sm" role="document">
      <div class="modal-content">
        <div class="modal-header alert-warning">
          <h5 class="modal-title"><i class="fas fa-exclamation-triangle"></i> Remove Overseer</h5>
          <button type="button" class="btn-close" data-dismiss="modal">&times;</button>
        </div>
        <div class="modal-body">
          <p>Remove overseer assignment from <strong id="removeOverseerCustomer"></strong>?</p>
          <p class="text-muted"><small>The customer will no longer have an assigned overseer.</small></p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-warning" id="confirmRemoveOverseerBtn">Remove</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Confirm Remove Custodian Modal -->
  <div class="modal fade" id="confirmRemoveCustodianModal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-sm" role="document">
      <div class="modal-content">
        <div class="modal-header alert-warning">
          <h5 class="modal-title"><i class="fas fa-exclamation-triangle"></i> Remove Custodian</h5>
          <button type="button" class="btn-close" data-dismiss="modal">&times;</button>
        </div>
        <div class="modal-body">
          <p>Remove custodian from <strong id="removeCustodianTerminal"></strong>?</p>
          <p class="text-muted"><small>The terminal will no longer have an assigned custodian.</small></p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-warning" id="confirmRemoveCustodianBtn">Remove</button>
        </div>
      </div>
    </div>
  </div>

  <!-- jQuery & Bootstrap -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // ========== SECTION NAVIGATION ==========
    document.querySelectorAll('.nav-item[data-section]').forEach(item => {
      item.addEventListener('click', (e) => {
        e.preventDefault();
        
        // Remove active from all nav items and sections
        document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
        document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
        
        // Add active to clicked item and corresponding section
        item.classList.add('active');
        const sectionId = item.getAttribute('data-section');
        document.getElementById(sectionId).classList.add('active');
      });
    });

    // ========== ALERT DISMISSAL ==========
    document.querySelectorAll('.close-alert').forEach(btn => {
      btn.addEventListener('click', (e) => {
        e.target.closest('.alert').remove();
      });
    });

    // ========== EDIT USER MODAL ==========
    document.querySelectorAll('.btn-edit').forEach(btn => {
      btn.addEventListener('click', function() {
        document.getElementById('user_id').value = this.dataset.id;
        document.getElementById('first_name').value = this.dataset.first_name;
        document.getElementById('last_name').value = this.dataset.last_name;
        document.getElementById('email').value = this.dataset.email;
        document.getElementById('phone').value = this.dataset.phone;
        document.getElementById('id_number').value = this.dataset.id_number;
        
        $('#editUserModal').modal('show');
      });
    });

    // ========== REMOVE ROLE CONFIRMATION ==========
    let removeRoleData = null;
    document.querySelectorAll('.btn-remove-role').forEach(btn => {
      btn.addEventListener('click', function() {
        removeRoleData = {
          userId: this.dataset.userId,
          username: this.dataset.username
        };
        document.getElementById('removeRoleUsername').textContent = this.dataset.username;
        $('#confirmRemoveRoleModal').modal('show');
      });
    });

    document.getElementById('confirmRemoveRoleBtn').addEventListener('click', function() {
      const form = document.createElement('form');
      form.method = 'POST';
      form.action = '{% url "admin_dashboard" %}';
      form.innerHTML = `
        {% csrf_token %}
        <input type="hidden" name="action" value="remove_assignment">
        <input type="hidden" name="target_type" value="role">
        <input type="hidden" name="user_id" value="${removeRoleData.userId}">
      `;
      document.body.appendChild(form);
      form.submit();
    });

    // ========== DELETE USER CONFIRMATION ==========
    let deleteUserData = null;
    document.querySelectorAll('.btn-delete-user').forEach(btn => {
      btn.addEventListener('click', function() {
        deleteUserData = {
          userId: this.dataset.userId,
          username: this.dataset.username
        };
        document.getElementById('deleteUsername').textContent = this.dataset.username;
        $('#confirmDeleteUserModal').modal('show');
      });
    });

    document.getElementById('confirmDeleteUserBtn').addEventListener('click', function() {
      const form = document.createElement('form');
      form.method = 'POST';
      form.action = '{% url "admin_dashboard" %}';
      form.innerHTML = `
        {% csrf_token %}
        <input type="hidden" name="action" value="delete_user">
        <input type="hidden" name="user_id" value="${deleteUserData.userId}">
      `;
      document.body.appendChild(form);
      form.submit();
    });

    // ========== REMOVE OVERSEER CONFIRMATION ==========
    let removeOverseerData = null;
    document.querySelectorAll('.btn-remove-overseer').forEach(btn => {
      btn.addEventListener('click', function() {
        removeOverseerData = {
          customerId: this.dataset.customerId,
          customerName: this.dataset.customerName
        };
        document.getElementById('removeOverseerCustomer').textContent = this.dataset.customerName;
        $('#confirmRemoveOverseerModal').modal('show');
      });
    });

    document.getElementById('confirmRemoveOverseerBtn').addEventListener('click', function() {
      const form = document.createElement('form');
      form.method = 'POST';
      form.action = '{% url "admin_dashboard" %}';
      form.innerHTML = `
        {% csrf_token %}
        <input type="hidden" name="action" value="remove_assignment">
        <input type="hidden" name="target_type" value="overseer">
        <input type="hidden" name="customer_id" value="${removeOverseerData.customerId}">
      `;
      document.body.appendChild(form);
      form.submit();
    });

    // ========== REMOVE CUSTODIAN CONFIRMATION ==========
    let removeCustodianData = null;
    document.querySelectorAll('.btn-remove-custodian').forEach(btn => {
      btn.addEventListener('click', function() {
        removeCustodianData = {
          customerId: this.dataset.customerId,
          terminalId: this.dataset.terminalId,
          terminalName: this.dataset.terminalName
        };
        document.getElementById('removeCustodianTerminal').textContent = this.dataset.terminalName;
        $('#confirmRemoveCustodianModal').modal('show');
      });
    });

    document.getElementById('confirmRemoveCustodianBtn').addEventListener('click', function() {
      const form = document.createElement('form');
      form.method = 'POST';
      form.action = '{% url "admin_dashboard" %}';
      form.innerHTML = `
        {% csrf_token %}
        <input type="hidden" name="action" value="remove_assignment">
        <input type="hidden" name="target_type" value="custodian">
        <input type="hidden" name="customer_id" value="${removeCustodianData.customerId}">
        <input type="hidden" name="terminal_id" value="${removeCustodianData.terminalId}">
      `;
      document.body.appendChild(form);
      form.submit();
    });
  </script>

 <div class="sidebar-overlay" onclick="document.querySelector('.sidebar').classList.remove('active'); this.classList.remove('active');"></div> 
</body>
</html>