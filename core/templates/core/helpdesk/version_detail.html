{% extends "base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" type="text/css" href="{% static 'css/version_detail.css' %}">
{% endblock %}

{% block title %}Version Detail{% endblock %}

{% block content %}

<div class="page-container detail-page-container">
  <h2 class="detail-header">ðŸ§¾ Version Details</h2>

  <div class="version-details-card">
    <table class="version-detail-table">
      <tr>
        <th>Terminal</th>
        <td>{{ version.terminal }}</td>
      </tr>
      <tr>
        <th>Manufacturer</th>
        <td>{{ version.manufacturer }}</td>
      </tr>
      <tr>
        <th>Template</th>
        <td>{{ version.template|default:"-" }}</td>
      </tr>
      <tr>
        <th>Firmware</th>
        <td>{{ version.firmware|default:"-" }}</td>
      </tr>
      <tr>
        <th>XFS</th>
        <td>{{ version.xfs|default:"-" }}</td>
      </tr>
      <tr>
        <th>BRITS</th>
        <td>{{ version.brits|default:"-" }}</td>
      </tr>
      <tr>
        <th>E-Journal</th>
        <td>{{ version.ejournal|default:"-" }}</td>
      </tr>
      <tr>
        <th>Responsible</th>
        <td>{{ version.responsible|default:"-" }}</td>
      </tr>
      <tr>
        <th>App Version</th>
        <td>{{ version.app_version|default:"-" }}</td>
      </tr>
      <tr>
        <th>Neo ATM</th>
        <td>{{ version.neo_atm|default:"-" }}</td>
      </tr>
      <tr>
        <th>Created At</th>
        <td>{{ version.created_at|date:"M d, Y H:i" }}</td>
      </tr>
    </table>
  </div>

  <div class="comments-section">
    <h4 class="comments-header">Add a Comment</h4>
    <form method="post" class="comment-form">
      {% csrf_token %}
      <div class="form-group">
        <textarea name="comment" class="form-control" rows="4" placeholder="Write a comment..."></textarea>
      </div>
      <button type="submit" class="btn btn-primary comment-submit-btn">Add Comment</button>
    </form>

    <hr class="comments-divider">

    <h4 class="comments-header">Previous Comments</h4>
    {% if comments %}
      <ul class="comments-list">
        {% for comment in comments %}
          <li class="comment-item">
            <p>{{ comment.text }}</p>
            <small class="comment-meta">{{ comment.created|date:"M d, Y H:i" }}</small>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="no-comments">No comments yet.</p>
    {% endif %}
  </div>

  <div class="action-buttons">
    <a href="{% url 'edit_version' version.pk %}" class="btn btn-warning action-btn">
      <i class="fas fa-edit"></i> Edit
    </a>
    
    <!-- Delete Button with Form for Confirmation Modal -->
    <form method="POST" action="{% url 'delete_version' version.pk %}" id="deleteVersionForm" style="display: inline; margin: 0;">
      {% csrf_token %}
      <button 
        type="button" 
        class="btn btn-danger action-btn"
        data-bs-toggle="modal" 
        data-bs-target="#deleteConfirmModal"
        data-version-id="{{ version.pk }}"
        data-terminal="{{ version.terminal }}"
        data-manufacturer="{{ version.manufacturer }}"
        data-template="{{ version.template|default:'N/A' }}"
        data-firmware="{{ version.firmware|default:'N/A' }}">
        <i class="fas fa-trash-alt"></i> Delete
      </button>
    </form>
    
    <a href="{% url 'version_controls' %}" class="btn btn-secondary action-btn">
      <i class="fas fa-arrow-left"></i> Back
    </a>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-labelledby="deleteConfirmModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header alert-danger">
        <h5 class="modal-title" id="deleteConfirmModalLabel">
          <i class="fas fa-exclamation-triangle"></i> Confirm Deletion
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body delete-confirm-body">
        <p>Are you sure you want to permanently delete this version entry?</p>
        
        <div class="version-details">
          <strong>Terminal:</strong> {{ version.terminal }}<br>
          <strong>Manufacturer:</strong> {{ version.manufacturer }}<br>
          <strong>Template:</strong> {{ version.template|default:"N/A" }}<br>
          <strong>Firmware:</strong> {{ version.firmware|default:"N/A" }}<br>
          {% if version.xfs %}<strong>XFS:</strong> {{ version.xfs }}<br>{% endif %}
          {% if version.brits %}<strong>BRITS:</strong> {{ version.brits }}<br>{% endif %}
          {% if version.ejournal %}<strong>E-Journal:</strong> {{ version.ejournal }}<br>{% endif %}
          {% if version.app_version %}<strong>App Version:</strong> {{ version.app_version }}<br>{% endif %}
          {% if version.neo_atm %}<strong>Neo ATM:</strong> {{ version.neo_atm }}<br>{% endif %}
        </div>

        <p class="text-danger">
          <i class="fas fa-exclamation-circle"></i> This action cannot be undone!
        </p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          <i class="fas fa-times"></i> Cancel
        </button>
        <button type="button" class="btn btn-danger" id="confirmDeleteBtn">
          <i class="fas fa-trash-alt"></i> Delete Version
        </button>
      </div>
    </div>
  </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
  // Delete confirmation functionality
  document.addEventListener('DOMContentLoaded', function() {
    const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
    const deleteForm = document.getElementById('deleteVersionForm');
    
    if (confirmDeleteBtn && deleteForm) {
      confirmDeleteBtn.addEventListener('click', function() {
        deleteForm.submit();
      });
    }
  });
</script>
{% endblock %}
