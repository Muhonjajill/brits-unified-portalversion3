{% extends "base.html" %}
{% load static %}

{% block title %}Ticketing Dashboard{% endblock %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'css/ticketing_dashboard.css' %}">
  <link rel="stylesheet" href="{% static 'css/ticketing_dashboard_modal.css' %}">
{% endblock %}

{% block content %}

<div class="dashboard-wrapper">

  <!-- Header -->
  <header class="dashboard-header">
    <h1><i class="fas fa-tachometer-alt"></i>Dashboard</h1>
  </header>

  <!-- KPI Stats -->
  <section class="kpi-section">
    {% for label, id, icon in kpi_data %}
        <a href="{% url 'show_tickets_by_period' period=label|lower %}" class="kpi-card gradient-{{ forloop.counter }}" data-period="{{ label|lower }}">
            <div class="icon"><i class="fas {{ icon }} fa-2x"></i></div>
            <div class="details">
                <h3>{{ label }}</h3>
                <p id="{{ id }}">0</p>
            </div>
        </a>
    {% endfor %}
</section>


  <!-- Charts Grid -->
  <section class="charts-grid">
    <!-- Ticket Trends Overview -->
    <div class="chart-card full-width" id="ticketTrendsOverview">
      <div class="card-header">
        <h2><i class="fas fa-chart-line"></i>  Ticket Trends Overview</h2>
        <i class="fas fa-ellipsis-h menu-btn"></i>
      </div>
      <canvas id="overviewChart" class="tall-chart"></canvas>
    </div>

    <!-- Problem Category Trends -->
    <div class="chart-card full-width" id="problemCategoryTrends">
      <div class="card-header">
        <h2><i class="fas fa-chart-line"></i> Problem Category Trends</h2>
        <i class="fas fa-ellipsis-h menu-btn"></i>
      </div>
      <canvas id="categoryTimeChart" class="tall-chart"></canvas>
    </div>

    <!-- Monthly Trends -->
    <div class="chart-card" id="monthlyTrendsOverview">
      <div class="card-header"><h2><i class="fas fa-calendar-alt"></i> Monthly Trends</h2></div>
      <canvas id="monthlyTrendChart"></canvas>
    </div>

    <!-- Time-based Trends -->
    <div class="chart-card" id="timebasedOverview">
      <div class="card-header"><h2><i class="fas fa-hourglass-half"></i> Time-Based Trends</h2></div>
      <canvas id="timeTrendChart"></canvas>
    </div>

    <!-- Tickets by Region -->
    <div class="chart-card {% if hide_region %}hidden{% endif %}" id="regionchartOverview">
      <div class="card-header">
        <h2><i class="fas fa-map-marker-alt"></i> Tickets by Region</h2>
      </div>
      <canvas id="regionChart" class="tall-chart"></canvas>
    </div>


    <!-- Distribution Breakdown -->
    <div class="chart-card full-width">
      <div class="card-header">
        <h2><i class="fas fa-bullseye"></i> Distribution Breakdown</h2>
      </div>
      <div class="charts-row">
        <div>
          <h3>By Priority</h3>
          <canvas id="priorityChart" class="tall-chart"></canvas>
        </div>
        <div>
          <h3>By Status</h3>
          <canvas id="statusChart" class="tall-chart"></canvas>
        </div>
      </div>
    </div>

    

    <!-- Tickets by Terminal -->
    <div class="chart-card full-width {% if hide_terminal %}hidden{% endif %}" id="terminalChartOverview">
      <div class="card-header">
        <h2><i class="fas fa-warehouse"></i> Tickets by Terminal</h2>
        <i class="fas fa-chart-bar menu-btn"></i>
      </div>
      <canvas id="terminalChart" class="tall-chart"></canvas>
    </div>

    <!-- Tickets by Customer -->
    <div class="chart-card full-width {% if hide_customer %}hidden{% endif %}" id="customerChartOverview">
      <div class="card-header"><h2><i class="fas fa-user"></i> Tickets by Customer</h2></div>
      <canvas id="customerChart" class="tall-chart"></canvas>
    </div>



  </section>
</div>
{% endblock %}

{% block extra_js %}
<!-- Load Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>

<!-- injected variables -->
<script>
  const STATUS_DATA = {{ status_data|default:'[]'|safe }};
  const PRIORITY_DATA = {{ priority_data|default:'[]'|safe }};
  const REGION_DATA = {{ region_data|default:"[]"|safe }};
  const MONTHLY_DATA = {{ monthly_data|default:'[]'|safe }};
  const TERMINAL_DATA = {{ terminal_data|default:"[]"|safe }};
  const OVERVIEW_DATA = {{ overview_data|default:'[]'|safe }};
  const CATEGORY_TIME_DATA = {{ category_time_data|default:'[]'|safe }};
  const CUSTOMER_DATA = {{ customer_data|default:'[]'|safe }};
  const TIME_DATA = {{ time_data|default:'{}'|safe }};
  const CATEGORY_DATA = {{ category_data|default:'[]'|safe }};


  if (TIME_DATA) {
    document.getElementById("dailyCount").textContent = TIME_DATA.day;
    document.getElementById("weeklyCount").textContent = TIME_DATA.week;
    document.getElementById("monthlyCount").textContent = TIME_DATA.month;
    document.getElementById("yearlyCount").textContent = TIME_DATA.year;
  }
</script>

<!-- dashboard JS -->
<script src="{% static 'js/ticketing_dashboard.js' %}"></script>
{% endblock %}
