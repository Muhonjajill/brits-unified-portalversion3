{% extends "base.html" %}
{% load static %}

{% block title %}Zones{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/zones.css' %}">
{% endblock %}

{% block content %}
<br>
<div class="page-container">
  <h2><i class="fas fa-map-marker-alt"></i> Zones</h2>
  <p>Manage zone classifications here.</p>

  <form method="post" action="{% url 'zones' %}" class="zone-form">
    {% csrf_token %}
    <input type="text" name="name" placeholder="Zone Name" required>
    <button type="submit" class="btn">
      <i class="fas fa-plus-circle"></i> Add Zone
    </button>
  </form> 

  <div class="table-responsive">
    {% if messages %}
      <ul class="messages">
        {% for message in messages %}
          <li class="alert alert-success">
            <i class="fas fa-check-circle"></i> {{ message }}
          </li>
        {% endfor %}
      </ul>
    {% endif %}

    <table class="zone-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Zone Name</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for zone in page_obj %}
        <tr>
          <td>{{ forloop.counter }}</td>
          <td>{{ zone.name }}</td>
          <td>
            <a href="#" 
               class="view-link delete-zone-btn"
               data-zone-id="{{ zone.id }}"
               data-zone-name="{{ zone.name }}"
               data-delete-url="{% url 'delete_zone' zone.id %}">
              <i class="fas fa-trash-alt"></i> Remove
            </a>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="3" style="text-align: center; color: #6c757d; padding: 20px;">
            No zones available.
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Pagination Links -->
  {% if page_obj.has_other_pages %}
  <div class="pagination">
    <span class="step-links">
      {% if page_obj.has_previous %}
        <a href="?page=1"><i class="fas fa-angle-double-left"></i> First</a>
        <a href="?page={{ page_obj.previous_page_number }}"><i class="fas fa-angle-left"></i> Previous</a>
      {% endif %}

      <span class="current">
        <i class="fas fa-file-alt"></i> Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
      </span>

      {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}">Next <i class="fas fa-angle-right"></i></a>
        <a href="?page={{ page_obj.paginator.num_pages }}">Last <i class="fas fa-angle-double-right"></i></a>
      {% endif %}
    </span>
  </div>
  {% endif %}
</div>

<!-- Delete Confirmation Modal -->
<div class="modal-overlay" id="deleteModal">
  <div class="modal-content">
    <div class="modal-header">
      <i class="fa-solid fa-triangle-exclamation"></i>
      <h3>Confirm Deletion</h3>
    </div>
    <div class="modal-body">
      <p>Are you sure you want to delete this zone?</p>
      <p><strong id="modalZoneName"></strong></p>
      <p>This action cannot be undone and will affect all terminals in this zone.</p>
    </div>
    <div class="modal-footer">
      <button class="modal-btn modal-btn-cancel" id="cancelDelete">Cancel</button>
      <button class="modal-btn modal-btn-confirm" id="confirmDelete">Delete Zone</button>
    </div>
  </div>
</div>

<script src="{% static 'js/ticketing_dashboard.js' %}"></script>
<script>
  document.addEventListener('DOMContentLoaded', function(){
    // Delete Modal Functionality
    const deleteModal = document.getElementById('deleteModal');
    const cancelDeleteBtn = document.getElementById('cancelDelete');
    const confirmDeleteBtn = document.getElementById('confirmDelete');
    const modalZoneName = document.getElementById('modalZoneName');
    let deleteUrl = '';

    // Add click event to all delete buttons
    document.querySelectorAll('.delete-zone-btn').forEach(btn => {
      btn.addEventListener('click', function(e) {
        e.preventDefault();
        
        const zoneName = this.getAttribute('data-zone-name');
        deleteUrl = this.getAttribute('data-delete-url');
        
        modalZoneName.textContent = zoneName;
        deleteModal.classList.add('active');
      });
    });

    // Cancel button
    cancelDeleteBtn.addEventListener('click', function() {
      deleteModal.classList.remove('active');
      deleteUrl = '';
    });

    // Confirm delete button
    confirmDeleteBtn.addEventListener('click', function() {
      if (deleteUrl) {
        window.location.href = deleteUrl;
      }
    });

    // Close modal when clicking outside
    deleteModal.addEventListener('click', function(e) {
      if (e.target === deleteModal) {
        deleteModal.classList.remove('active');
        deleteUrl = '';
      }
    });

    // Close modal on ESC key
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && deleteModal.classList.contains('active')) {
        deleteModal.classList.remove('active');
        deleteUrl = '';
      }
    });
  });
</script>
{% endblock %}
